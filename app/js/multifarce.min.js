/*
 * Copyright (c) 2009 Andreas Blixt <andreas@blixt.org>
 * This and more JavaScript libraries: http://blixt.org/js
 * MIT License: http://www.opensource.org/licenses/mit-license.php
 * 
 * Event source "class"
 * Adds event functionality to an object.
 */
var EventSource=function(){var e={},c=arguments,d,a,b,f=Array.prototype.slice;for(d=0,a=c.length;d<a;d++){b=c[d];if(typeof b!="string"){throw"Type error (argument); expected string."}e[b]=[]}this.clearHandlers=function(g){if(g){if(typeof g!="string"){throw"Type error (event); expected string."}if(!(g in e)){throw"Unsupported event: "+g}e[g].length=0}else{for(var h in e){e[h].length=0}}};this.listen=function(h,g,i){if(typeof h!="string"){throw"Type error (event); expected string."}if(!(h in e)){throw"Unsupported event: "+h}if(typeof g!="function"){throw"Type error (handler); expected function."}e[h].push([g,i||this])};this.raise=function(k){var m=e[k],j,g,h=f.call(arguments,1);for(j=0,g=m.length;j<g;j++){m[j][0].apply(m[j][1],h)}};this.unlisten=function(j,h,l){if(typeof j!="string"){throw"Type error (event); expected string."}if(!(j in e)){throw"Unsupported event: "+j}var k=e[j],g;for(g=k.length-1;g>=0;g--){if(k[g][0]==h){if(l&&l!=k[g][1]){continue}k.splice(g,1)}}}};
/*
 * Copyright (c) 2009 Andreas Blixt <andreas@blixt.org>
 * This and more JavaScript libraries: http://blixt.org/js
 * MIT License: http://www.opensource.org/licenses/mit-license.php
 * 
 * Hash handler
 * Keeps track of the history of changes to the hash part in the address bar.
 */
var Hash=(function(){var h=this,f=document.documentMode,g=h.history,k=h.location,b,l,e,c,d=function(){if(!k.search){return k.hash.substr(1)}var m=k.href.indexOf("#");return(m==-1?"":k.href.substr(m+1))},i=function(){var m=d();if(m!=e){e=m;l(m)}},a=function(m){try{var o=c.contentWindow.document;o.open();o.write("<html><body>"+m+"</body></html>");o.close();e=m}catch(n){setTimeout(function(){a(m)},10)}},j=function(){try{c.contentWindow.document}catch(n){setTimeout(j,10);return}a(e);var m=e;setInterval(function(){var o,p;try{o=c.contentWindow.document.body.innerText;if(o!=m){m=o;k.hash=e=o;l(o)}else{p=d();if(p!=e){a(p)}}}catch(q){}},50)};return{init:function(m,n){if(l){return}l=m;e=d();m(e);if(h.ActiveXObject){if(!f||f<8){c=n;j()}else{h.attachEvent("onhashchange",i)}}else{if(g.navigationMode!==b){g.navigationMode="compatible"}setInterval(i,50)}},go:function(m){if(m==e){return}if(c){a(m)}else{k.hash=e=m;l(m)}}}})();
/*
 * Copyright (c) 2009 Andreas Blixt <andreas@blixt.org>
 * This and more JavaScript libraries: http://blixt.org/js
 * MIT License: http://www.opensource.org/licenses/mit-license.php
 * 
 * Simple JSON encoder/decoder
 * Encodes/decodes JavaScript values as JSON (see http://json.org/)
 */
if(!JSON){var JSON=(function(){var c=new RegExp('[\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\ufeff\ufff0-\uffff]',"g"),a={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},b=function(d){return a[d]||"\\u"+("000"+d.charCodeAt(0).toString(16)).slice(-4)};return{stringify:function(h){switch(typeof h){case"string":return'"'+h.replace(c,b)+'"';case"object":if(h==null){return"null"}var e=[],g,f,d,j;if(h instanceof Array){for(f=0,d=h.length;f<d;f++){if((g=JSON.stringify(h[f]))!=null){e[e.length]=g}}return"["+e+"]"}for(j in h){if((g=JSON.stringify(h[j]))!=null){e[e.length]=JSON.stringify(j)+":"+g}}return"{"+e+"}";case"number":return isFinite(h)?String(h):"null";case"boolean":return String(h)}return null},parse:function(d){if(typeof d!="string"){return null}return JSON.e("("+d+")")}}})();JSON.e=function(c){return eval(c)};
/*
 * Copyright (c) 2009 Andreas Blixt <andreas@blixt.org>
 * This and more JavaScript libraries: http://blixt.org/js
 * MIT License: http://www.opensource.org/licenses/mit-license.php
 * 
 * Service client library (Depends on jQuery, JSON)
 * Handles communication with an API through simple HTTP requests.
 */
}var ServiceClient=(function(d,e){var b=function(i,h,j,f){i.attempts++;if(i.attempts<3){d.ajax(h)}else{var g={message:"The request failed after "+i.attempts+" attempts.",type:"JavaScriptError"};if(i.onError){i.onError.call(i.bindError||i.bind,g)}else{alert(g.type+": "+g.message)}}},c=function(g,f){switch(f.status){case"error":if(g.onError){g.onError.call(g.bindError||g.bind,f.response)}else{alert(f.response.type+": "+f.response.message)}break;case"list":break;case"success":if(g.onSuccess){g.onSuccess.call(g.bind,f.response)}break;default:alert("Unknown status: "+f.status);break}},a=function(k){var j,i=null,g=null,f=[],h=false;this.set_errorHandler=function(l,m){if(l===null){i=null;return}if(typeof l!="function"){throw"Type error (func); expected function or null."}if(typeof m!="object"&&typeof m!="undefined"){throw"Type error (bind); expected object."}i=l;g=m};this.get_path=function(){return k};this.call=function(n,t,s,r,p,o){if(typeof n!="string"){throw"Type error (action); expected string."}if(h){f[f.length]=arguments;return}h=true;var l={attempts:0,bind:r,bindError:o||g,onError:p||i,onSuccess:s};var m=[];for(var v in t){var w=e.stringify(t[v]);if(w){m[m.length]=v+"="+encodeURIComponent(w)}}var u=this;d.ajax({cache:false,complete:function(){h=false;if(f.length>0){u.call.apply(u,f.shift())}},data:m.join("&"),dataType:"json",error:function(x,q){b(l,this,x,q)},success:function(q){c(l,q)},timeout:3000,url:k+n})}};return a})(jQuery,JSON);
/*
 * Copyright (c) 2009 Andreas Blixt <andreas@blixt.org>
 * This and more JavaScript libraries: http://blixt.org/js
 * MIT License: http://www.opensource.org/licenses/mit-license.php
 * 
 * jQuery hash plugin (Depends on jQuery, Hash)
 * Plugin for detecting changes to the hash and for adding history support for
 * hashes to certain browsers.
 */
(function(i,e){var d="jquery-history",f="/js/blank.html",a="hashchange",j="hash.fn",h,c=this,b=document.documentMode,g=function(k){i.event.trigger(a,[k])};i.hash={init:function(l){if(h){return}h=1;var k;if(c.ActiveXObject&&(!b||b<8)){i("body").prepend('<iframe id="'+d+'" style="display:none;" src="'+(l||f)+'"></iframe>');k=i("#"+d)[0]}e.init(g,k)},go:e.go};i.fn.hash=function(l,m){var k=this.data(j);if(k){this.unbind("click",k)}if(typeof l=="string"){k=function(){e.go(l);return false};this.data(j,k);this.click(k);if(m||m===undefined){this.attr("href","#"+l)}}return this};i.fn[a]=function(k){return this.bind(a,k)}})(jQuery,Hash);
/*
 * Copyright (c) 2009 Andreas Blixt <andreas@blixt.org>
 * This and more JavaScript libraries: http://blixt.org/js
 * MIT License: http://www.opensource.org/licenses/mit-license.php
 *
 * Application handler
 *
 * Handles path maps that direct control to handlers, along with the query
 * string parameters. Recommended use is for supporting paths in the hash part
 * of the address bar.
 */
var Application=(function(){var d=/\.([A-F0-9]{2})/g,e=function(f,g){return String.fromCharCode(parseInt(g,16))},b=/[^A-Za-z0-9,_!~*'()-]/g,c=function(f){var g=f.charCodeAt(0);if(g>255){return""}else{return(g<16?".0":".")+g.toString(16).toUpperCase()}},a=function(k){var j=[],f=[],h=function(l,i){if(typeof l=="string"){l=new RegExp(l)}if(!(l instanceof RegExp)){throw"Type error (pattern); expected RegExp or string."}if(typeof i!="function"){throw"Type error (handler); expected function."}j.push(l);f.push(i)};for(var g=0;g<k.length;g++){h(k[g][0],k[g][1])}this.exec=function(s){var u,r,t,o={},m,p,q,n;if((q=s.indexOf("?"))>=0){m=s.substr(q+1).split("&");u=s.substr(0,q);for(q=0,n=m.length;q<n;q++){p=m[q].split("=",2);o[a.decode(p[0])]=(p.length==2?a.decode(p[1].replace(/\+/g," ")):true)}}else{u=s}for(q=0,n=j.length;q<n;q++){r=j[q].exec(u);if(r){r=r.slice(1);t=new f[q](this,s,u,r,o);t.run.apply(t,r);return}}}};a.decode=function(f){return f.replace(d,e)},a.encode=function(f){return f.replace(b,c)},a.handler=function(f){var g=function(l,h,j,i,k){this.get_param=function(m,n){return(m in k?k[m]:n)};this.get_matches=function(){var o=[],n,m;for(n=0,m=i.length;n<m;n++){o[n]=i[n]}return o};this.get_params=function(){var m={},n;for(n in k){m[n]=k[n]}return m};this.get_path=function(){return j};this.get_requestPath=function(){return h};this.get_app=function(){return l}};g.prototype={delay:function(j){var i=this;return setTimeout(function(){i.run.apply(i,i.get_matches())},j)},redirect:function(j){var k=this.get_matches(),i=new j(this.get_app(),this.get_path(),k,this.get_params());i.run.apply(i,k)},run:f};return g};return a})();
/*
 * multifarce client library
 * http://code.google.com/p/multifarce/
 * http://beta.multifarce.com/
 * Copyright (c) 2009 Andreas Blixt <andreas@blixt.org>
 *
 * Licensed under the Apache License, Version 2.0 (the "License"); you may not
 * use this file except in compliance with the License. You may obtain a copy
 * of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
 * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
 * License for the specific language governing permissions and limitations
 * under the License.
 */
(function(i,f,a,c,l,d,h,b){d.easing.easeInQuart=function(o,p,n,r,q){return r*(p/=q)*p*p*p+n};d.fn.formattedText=function(o){var n="<p>"+this.text(o).html()+"</p>";n=n.replace(/\*([^*\r\n]+)\*/g,"<strong>$1</strong>");n=n.replace(/_([^_\r\n]+)_/g,"<em>$1</em>");n=n.replace(/(\r\n|[\r\n]){2,}/g,"</p><p>");n=n.replace(/(\r\n|[\r\n])/g,"<br/>");return this.html(n)};d.fn.hasEvent=function(o){var n=this.data("events");return n&&n[o]};var k="multifarce",g="/api/";var e=(function(){var o={},n,t,p,q,s,r=function(x,A,w){if(w){var B=x,u,v;for(u in A){B+="|!|"+u+":"+A[u]}v=o[B];if(v&&+new Date()<v.expires){if(v.data){if(t){var C=t,z=p;t=b;p=b;q=b;s=b;C.call(z,v.data);return}}else{v.queue.push([t,p,q,s])}}else{v=o[B]={queue:[[t,p,q,s]],expires:+new Date()+w};var y=v.queue;n.call(x,A,function(F){v.data=F;for(var D=0,E;D<y.length;D++){E=y[D];if(E[0]){E[0].call(E[1],F)}}y.length=0},b,function(D){for(var E=0,F;E<y.length;E++){F=y[E];if(F[2]){F[2].call(F[3],D)}}delete o[B]})}}else{n.call(x,A,t,p,q,s)}t=b;p=b;q=b;s=b};n={clean:function(u){r("clean",{command:u})},createCommand:function(v,u,A,x,z,y,w){r("create_command",{frame:v,commands:u,text:A,go_to_frame:x,flags_on:z,flags_off:y,flags_required:w})},createFrame:function(v,u){r("create_frame",{title:v,text:u})},execute:function(w,v,u){r("execute",{frame:w,command:v,flags:u},60000)},getCommand:function(u){r("get_command",{command:u},120000)},getCommands:function(u){r("get_commands",{by:u},120000)},getFirstFrame:function(){r("get_first_frame",{},600000)},getFrame:function(u){r("get_frame",{frame:u},120000)},getFrames:function(u){r("get_frames",{by:u},120000)},getStatus:function(u){r("get_status",{path:u})},getTopCommands:function(u){r("get_top_commands",{frame:u},120000)},getUserInfo:function(u){r("get_user_info",{user:u},60000)},logIn:function(v,u){r("log_in",{username:v,password:u})},logOut:function(){r("log_out",{})},register:function(x,u,w,v){r("register",{username:x,display_name:u,password:w,email:v})},error:function(v,u){q=v;s=u;return this},success:function(u,v){t=u;p=v;return this}};h.call(n,g);return n})();var m=(function(){var s,q,o,r=function(t){this.raise("execute-error",t)},p=function(t){if(t.frame_id!=s){s=t.frame_id;e.success(n,this).getFrame(s)}o=t.flags;this.raise("execute-success",t)},n=function(t){s=t.id;q=t.title;e.getTopCommands(t.id);this.raise("frame-load",t)};return{get_frameId:function(){return s},get_frameTitle:function(){return q},get_state:function(){return s+","+o.join(",")},set_state:function(v){var u=v.split(","),w=parseInt(u.shift(),10);if(w&&w!=s){for(var t=u.length-1;t>0;t--){if(!u[t]){u.splice(t,1)}}this.start(w,u)}},execute:function(t){if(!t){return}if(!s){this.raise("execute-error",{message:"The game has not been started!"});return}e.error(r,this).success(p,this);e.execute(s,t,o)},start:function(t,u){s=t||0;o=u||[];e.success(n,this);if(s>0){e.getFrame(s)}else{e.getFirstFrame()}}}})();c.call(m,"execute-success","execute-error","frame-load");var j=(function(){var p={},n,o=function(u){c.call(this,"load");var r=false,s={},q=function(){this.clearHandlers();if(u){delete p[u]}},t=function(v){s=v;r=true;this.raise("load")};this.get_displayName=function(){return s.display_name};this.get_emailHash=function(){return s.email_md5};this.get_username=function(){return s.username};this.isCurrent=function(){return this==n};this.isLoaded=function(){return r};if(!u){this.get_email=function(){return s.email};this.get_googleEmail=function(){return s.google_email};this.get_googleLogUrl=function(){return s.google_login||s.google_logout};this.get_googleNickname=function(){return s.google_nickname};this.get_type=function(){return s.type};this.googleLoggedIn=function(){return s.google_logged_in};this.loggedIn=function(){return s.logged_in}}this.load=function(v){if(v){t.call(this,v);return}e.success(t,this).error(q,this);if(u){e.getUserInfo(u)}else{e.getStatus()}}};o.current=function(){if(!n){n=new o()}return n};o.get=function(q){if(typeof q!="string"){throw"Invalid type (username); expected string."}if(q in p){return p[q]}else{p[q]=new o(q)}};o.logIn=function(u,r,t,q){var s=o.current();if(s.loggedIn()){return}e.success(function(v){s.load(v);if(t){t(v)}});if(q){e.error(q)}e.logIn(u,r)};o.logOut=function(){var q=o.current();if(!q.loggedIn()){return}if(q.googleLoggedIn()){location.href=q.get_googleLogUrl();return}e.success(function(){q.load()});e.logOut()};return o})();d(function(){d.fn.command=function(H){var G=this;G.hash("commands/"+H).text("[Command#"+H+"]");e.success(function(I){G.text(I.synonyms.join(", "))}).getCommand(H);return G};d.fn.frame=function(H){var G=this;G.hash("frames/"+H).text("[Frame#"+H+"]");e.success(function(I){G.text(I.title)}).getFrame(H);return G};var q=d("div.page"),B=d("#avatar img"),p=d("#username"),C=d("#action-1 a"),A=d("#action-2 a"),x,t,r;(function(){var G=d("#page-name"),J=q.eq(0),H=d("#notifications");for(var I=1;I<q.length;I++){q.eq(I).remove()}x=function(){return J};t=function(O,N,M,L){var K=s.loggedIn();if(M&&!K){if(K===false){if(typeof M=="string"){r(M,"hint")}d.hash.go("log-in?continue="+a.encode(L.get_requestPath()).replace(/ /g,"+"))}else{setTimeout(function(){t(O,N,M,L)},50)}return}if(O){G.text(O);i.title=O+" - "+k}if(!N||J[0]==N[0]){return}J.replaceWith(N);J=N};r=function(M,K,L){H.empty();H.append(d("<p/>").addClass(K||"message").append(d('<a href="#"/>').click(function(){d(this).closest("p").remove();if(L){L()}return false}).text(M).prepend('<span class="close">&times;</span>')).hide().fadeIn(500).animate({opacity:0},15000,"easeInQuart",function(){d(this).remove()}))}})();d("body").removeClass("dom-loading").ajaxStart(function(){d(this).addClass("loading")}).ajaxStop(function(){d(this).removeClass("loading")});e.set_errorHandler(function(G){r(G.message,"error")});var s=j.current();var F;(function(){var G=q.filter("#create-page");commandSuggestions=G.find("#create-command-suggestions"),frames=G.find("#create-frames"),commands=G.find("#create-commands"),F=a.handler(function(){frames.empty();commands.empty();if(s.loggedIn()){e.success(function(I){for(var H=0;H<I.length;H++){frames.append(d("<li/>").append(d("<a/>").hash("frames/"+I[H].id).text(I[H].title)))}});e.getFrames(s.get_username());e.success(function(I){for(var H=0;H<I.length;H++){commands.append(d("<li/>").append(d("<a/>").hash("commands/"+I[H].id).text(I[H].synonyms.join(", "))).append(" on ").append(d("<a/>").frame(I[H].frame_id)))}});e.getCommands(s.get_username())}t("Create",G,"You need to log in before you can create stuff!",this)})})();var v;(function(){var M=q.filter("#home-page"),N=M.find("#current-frame"),I=N.children("h3"),L=N.children("div.text"),K=M.find("#action"),G=M.find("#action-go"),H=M.find("#log"),J=function(){var O=K.val().toLowerCase();if(!O){return}K.val("");H.prepend(d('<div class="command"/>').text("> "+O));if(O=="reset"||O=="start"){H.prepend(d('<div class="result"/>').text("Starting..."));m.start()}else{m.execute(O)}K.focus()};H.remove();d("#action").live("keydown",function(O){if(O.keyCode==13){J()}});d("#action-go").live("click",J);m.listen("frame-load",function(O){if(m.get_frameId()){d.hash.go("?state="+m.get_state())}t(O.title,M);N.stop(true).animate({height:0,opacity:0},400).queue(function(){I.text(O.title);L.formattedText(O.text);N.css({position:"absolute",height:"auto"});N.animate({height:N.height(),opacity:1},1000);N.css({height:0,position:"static"});N.dequeue()});H.prepend(d('<div class="frame"/>').append(d('<p class="entering"/>').append("Entering ").append(d("<strong/>").text(O.title))).append(d("<div/>").formattedText(O.text)))});m.listen("execute-error",function(O){if(O.code=="COMMAND_NOT_FOUND"){r('The command "'+O.data+'" does not exist yet! Click here to create it!',"hint",function(){d.hash.go("commands/new?frame="+m.get_frameId()+"&command="+O.data.replace(/ /g,"+"))})}else{r(O.message,"error")}H.prepend(d('<div class="result"/>').text(O.message))});m.listen("execute-success",function(O){d.hash.go("?state="+m.get_state());r(O.text,"hint");H.prepend(d('<div class="result"/>').text(O.text))});K.focus();v=a.handler(function(){var O=m.get_frameId(),P=this.get_param("state");if(P){m.set_state(P)}else{if(O>0){d.hash.go("?state="+m.get_state())}}t(m.get_frameTitle()||"Hello World!",M)})})();var y;(function(){var K=q.filter("#log-in-page"),L=K.find("#log-in-username"),H=K.find("#log-in-password"),J=K.find("#log-in-go"),G="",I=["Hi {name}!","Howdy {name}!","Hello {name}!","Yo {name}!","G'day {name}!","¡Hola {name}!","Salut {name}!","Konnichiwa {name}!","Ciao {name}!"];d("#log-in-go").live("click",function(){j.logIn(L.val(),H.val(),function(M){var N=Math.floor(Math.random()*I.length);r(I[N].replace("{name}",M.display_name),"success");d.hash.go(G)});H.val("")});y=a.handler(function(){G=this.get_param("continue","");L.val("");H.val("");t("Log in",K)})})();var n;(function(){var G=q.filter("#log-out-page");n=a.handler(function(){t("Log out",G);j.logOut()})})();var z;(function(){var L=q.filter("#new-command-page"),I=L.find("#new-command-frame"),G=L.find("#new-command-1"),Q=L.find("#new-command-2"),P=L.find("#new-command-3"),O=L.find("#new-command-4"),M=L.find("#new-command-5"),K=L.find("#new-command-clean"),N=L.find("#new-command-text"),H=L.find("#new-command-go-to-frame"),J=L.find("#new-command-go");d("#new-command-go").live("click",function(){var R=[G.val(),Q.val(),P.val(),O.val(),M.val()];var S=parseInt(I.val(),10);var T=parseInt(H.val(),10);if(T<=0){T=null}e.success(function(U){r("The command has been successfully created!","success");d.hash.go("commands/"+U.id)});e.createCommand(S,R,N.val(),T)});d("#new-command-clean").live("click",function(){e.success(function(R){G.val(R[0]||"");Q.val(R[1]||"");P.val(R[2]||"");O.val(R[3]||"");M.val(R[4]||"")});e.clean([G.val(),Q.val(),P.val(),O.val(),M.val()]);return false});z=a.handler(function(){I.empty();H.empty();G.val(this.get_param("command",""));Q.val("");P.val("");O.val("");M.val("");N.val("");e.success(function(S){H.append('<option value="-1">(No frame)</option>');for(var R=0;R<S.length;R++){I.append(d("<option/>").val(S[R].id).text(S[R].title));H.append(d("<option/>").val(S[R].id).text(S[R].title))}I.val(this.get_param("frame",""))},this).getFrames();t("Creating new command",L,"You will need to log in before you can create a command!",this)})})();var o;(function(){var H=q.filter("#new-frame-page"),J=H.find("#new-frame-title"),I=H.find("#new-frame-text"),G=H.find("#new-frame-go");d("#new-frame-go").live("click",function(){e.success(function(K){r("The frame has been successfully created!","success");d.hash.go("frames/"+K.id)});e.createFrame(J.val(),I.val())});o=a.handler(function(){J.val("");I.val("");t("Creating new frame",H,"You will need to log in before you can create a frame!",this)})})();var w;(function(){var G=q.filter("#not-found-page"),H=G.find("#not-found-path");w=a.handler(function(){H.text(this.get_path());t("Path not found!",G)})})();var D;(function(){var M=q.filter("#register-page"),N=M.find("#register-username"),G=M.find("#register-name"),I=M.find("#register-email"),H=M.find("#register-password"),L=M.find("#register-password-2"),K=M.find("input[name=register-use-google]"),J=M.find("#register-go");d("#register-go").live("click",function(){if(K.filter(":checked").val()=="no"){if(!H.val()){r("You must enter a password.","error");return}else{if(H.val()!=L.val()){r("The passwords do not match.","error");return}}}e.success(function(){r("You have been successfully registered!","success");if(s.googleLoggedIn()){s.load();d.hash.go("")}else{d.hash.go("log-in")}});e.register(N.val(),G.val(),H.val()||null,I.val())});d("#register-page input[name=register-use-google]").live("click",function(){if(K.filter(":checked").val()=="yes"){d([H[0],L[0]]).attr("disabled",true).val("").parent().addClass("disabled")}else{d([H[0],L[0]]).attr("disabled",false).parent().removeClass("disabled")}});D=a.handler(function(){N.val("");G.val("");I.val(s.googleLoggedIn()?s.get_googleEmail():"");H.val("");L.val("");K.val("no");t("Register",M)})})();var u=new a([["^$",v],["^commands/new$",z],["^create$",F],["^frames/new$",o],["^log-in$",y],["^log-out$",n],["^register$",D],["^.*$",w]]);d(i).hashchange(function(H,G){u.exec(G)});d.hash.init();var E=function(G,H){q.find(G).each(function(){var I=d(this),J=I.data("hidden");if(J){I.append(J)}I.removeData("hidden")});q.find(H).each(function(){var I=d(this);if(I.data("hidden")){return}I.data("hidden",I.children().remove())})};s.listen("load",function(){if(this.loggedIn()){p.empty().append(d("<a/>").hash("profile").text(this.get_displayName()));B.attr("src","http://www.gravatar.com/avatar/"+this.get_emailHash()+"?s=28&d=identicon&r=PG");C.text("Create").hash("create");A.text("Log out").hash("log-out")}else{p.text("Not logged in");B.attr("src","http://www.gravatar.com/avatar/?s=28&d=identicon&r=PG");C.text("Register").hash("register");A.text("Log in").hash("log-in")}var G,H;if(this.googleLoggedIn()){G="div.google";H="div.not-google"}else{G="div.not-google";H="div.google"}if(this.loggedIn()){G+=", div.multifarce";H+=", div.not-multifarce"}else{G+=", div.not-multifarce";H+=", div.multifarce"}E(G,H);q.find("a.google-accounts").attr("href",this.get_googleLogUrl())});E("","div.google, div.not-google, div.multifarce, div.not-multifarce");s.load()})})(document,window,Application,EventSource,Hash,jQuery,ServiceClient);